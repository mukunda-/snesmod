SOUNDBANK STRUCTURE
===================

OFFSET	SIZE		DESCRIPTION
0000H	WORD		NUMBER OF SOURCES [SAMPLE DATA] IN BANK
0002H	WORD		NUMBER OF MODULES IN BANK
0004H	BYTE*3*128	POINTERS TO MODULES (LONG ROM ADDRESS)
0184H	BYTE*3*N	POINTERS TO SOURCES (LONG ROM ADDRESS)

MODULE 
======

HEADER:
0000H	WORD		SIZE OF MODULE / 2 (NUMBER OF WORDS)
0002H	WORD		NUMBER OF ENTRIES IN SOURCE LIST
0004H	WORD*N		SOURCE LIST
---

0000H	BYTE		INITIAL VOLUME
0001H	BYTE		INITIAL TEMPO
0002H	BYTE		INITIAL SPEED
0003H	BYTE*8		INITIAL CHANNEL VOLUME (0..64)
000BH	BYTE*8		INITIAL CHANNEL PANNING (0..64)

0013H	BYTE		ECHO VOLUME (L)
0014H	BYTE		ECHO VOLUME (R)
0015H	BYTE		ECHO DELAY (0..15)
0016H	BYTE		ECHO FEEDBACK (-128..127)
0017H	BYTE*8		ECHO FIR COEFFICIENTS (-128..127)
001FH	BYTE		ECHO ENABLE (1BIT/CHANNEL)

0020H	BYTE*200	SEQUENCE
00E8H	BYTE*64		POINTERS TO PATTERNS (LOBYTE)
0128H	BYTE*64		POINTERS TO PATTERNS (HIBYTE)
0168H	BYTE*64		POINTERS TO INSTRUMENTS (LOBYTE)
01A8H	BYTE*64		POINTERS TO INSTRUMENTS (HIBYTE)
01E8H	BYTE*64		POINTERS TO SAMPLES (LOBYTE)
0228H	BYTE*64		POINTERS TO SAMPLES (HIBYTE)

PATTERN
=======

0000H	BYTE		NUMBER OF ROWS IN PATTERN MINUS 1
0001H	BYTE*?		COMPRESSED SEQUENCER DATA

INSTRUMENT
==========

0000H	BYTE		FADEOUT
0001H	BYTE		SAMPLE INDEX
0002H	BYTE		GLOBAL VOLUME
0003H	BYTE		SET PAN (&128=IGNORE)
0004H	BYTE		LENGTH OF ENVELOPE (0=DISABLED)
0005H	BYTE		*ENVELOPE SUSTAIN POINT (&128=DISABLED)
0006H	BYTE		*ENVELOPE LOOP START (&128=DISABLED)
0007H	BYTE		*ENVELOPE LOOP END (&128=DISABLED)
0008H	BYTE*4*N	*ENVELOPE DATA, N = LENGTH / 4

ALL LENGTHS AND POINTS ARE IN BYTES, 4 BYTES PER NODE
*ENVELOPE PARAMS ARE NOT PRESENT IF LENGTH = 0

SAMPLE
======

0000H	BYTE		DEFAULT VOLUME
0001H	BYTE		GLOBAL VOLUME
0002H	WORD		PITCH BASE
0004H	BYTE		DIRECTORY INDEX
0005H	BYTE		SET PAN (&128 = DISABLED)

SOURCE
======
0000H	WORD		LENGTH OF SOURCE DATA
0002H	WORD		LOOP OFFSET
0004H	BYTE*LENGTH	BRR SOURCE DATA

==============================
NOTES
==============================

ALL DATA IS ALIGNED BY 2 (TO AVOID TROUBLE WHEN
PASSING BETWEEN BANKS)

MODULE/SOURCE POINTERS

FOR LOROM MODE:
  THE LOW TWO BYTES ARE IN RANGE 8000H -> FFFFH
   (THEY ARE A ROM ADDRESS)
  THE TOP BYTE IS THE BANK BYTE
  TO CALCULATE ADDRESS IN ROM:
  
  BANK = SOUNDBANK_BANK_START + THIRD_BYTE(I)
  ADDRESS = LOWER_TWO_BYTES(I)
  
  THE DATA MAY PASS INTO THE NEXT BANK...

FOR HIROM MODE:
  THE LOW TWO BYTES ARE IN RANGE 0000H -> FFFFH
  THE TOP BYTE IS THE (64K) BANK BYTE

  SOUNDBANK MUST HAVE DEDCIATED BANK(S)

ECHO
  "ECHO MASTER ENABLE" IS IMPLIED IF ECHO DELAY IS NOT ZERO

SEQUENCE
  0-253 = PATTERN INDEX
  254 = "+++" SKIP ENTRY
  255 = "---" END OF SONG

POINTER TABLES IN MODULE
  THESE POINTERS POINT TO ACTUAL MEMORY LOCATIONS IN SPC MEMORY
  SO THEY WILL POINT TO "MODULE_BASE"+X
  THE LOW AND HIGH BYTES OF THE 16-BIT ADDRESS ARE NOT INTERLEAVED
  TO MAKE THE DATA ACCESS ON THE SPC LESS COMPLEX

SOURCE LIST
  A NULL TERMINATED WORD LIST CONTAINING SAMPLE INDECES REQUIRED
  BY THIS MODULE, THE SPC SHOULD POPULATE THE SAMPLE DIRECTORY
  WITH THE SOURCES POINTED TO BY THIS LIST

COMPRESSED SEQUENCE DATA
  THE DATA IS STORED AS FOLLOWS:
    FOR EACH ROW IN PATTERN:
      BYTE: NOTE HINTS
      BYTE: UPDATE BITS <- BITS CORRESPOND TO WHICH CHANNELS HAVE DATA
    IF BIT IS SET FOR CHANNEL:
      READ BYTE
        [evinEVIN] 
        HI BITS:evin = new effect/param,vcmd,instrument,note
        LO BITS: EVIN = entry has note,instrument,vcmd,effect/param
              (use previous data if HI BIT is not set)
      NOTE,INSTR,VCMD,EFFECT follow if bits are set

FADEOUT
  FADEOUT VALUE IS 1/4 OF IT VALUE
  FADEOUT SHOULD BE INITIALIZED TO 255 ON KEYON RATHER THAN 1024

INSTRUMENT ENVELOPE
  THE INSTRUMENT ENVELOPE IS THE 'VOLUME' ENVELOPE
  PANNING/PITCH ENVELOPES ARE NOT SUPPORTED
  THE LENGTH/SUSTAIN/LOOPSTART/LOOPEND VALUES SHOULD
  BE MULTIPLES OF 4. THEY ARE MEASURED AS BYTE OFFSETS
  INTO THE ENVELOPE DATA RATHER THAN "NODE" OFFSETS.

ENVELOPE DATA
  EACH NODE IS AS FOLLOWS:
    BYTE0: LEVEL (0..64) (RESET TO THIS VALUE WHEN NODE IS REACHED)
    BYTE1: DURATION (1..256 TICKS)
    BYTE2,3: SIGNED DELTA 8.8 FIXED POINT (ADD TO LEVEL EACH TICK)

PITCH BASE:
  SEE TUNING.TXT

SOURCE LENGTH
  THIS IS THE LENGTH OF THE BRR SOURCE DATA

SOURCE LOOP
  THIS IS THE OFFSET IN THE SOURCE DATA WHERE THE LOOP BEGINS
  IT SHOULD BE A MULTIPLE OF 9 WHICH IS THE LENGTH OF ONE BRR BLOCK
  0FFFFH = ONE-SHOT SAMPLE
